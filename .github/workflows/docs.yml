
name: Docs

on:
  push:
    branches:
      - '**'
    paths-ignore:
      - 'CHANGES'
      - 'openvdb_maya/**'
      - '**/*.md'
  pull_request:
    branches:
      - '**'
    paths-ignore:
      - 'CHANGES'
      - 'openvdb_maya/**'
      - '**/*.md'

jobs:
  doxygen:
    runs-on: ubuntu-16.04
    env:
      CXX: g++
    container:
      image: aswf/ci-openvdb:2019
    steps:
    - uses: actions/checkout@v2
    - name: install_doxygen
      run: ./ci/install_doxygen.sh 1_8_11
    - name: install_epydoc
      run: pip install epydoc
    - name: install_latex
      run: yum -y install texlive-latex-bin texlive-dvips
    - name: mkdir
      run: mkdir -p $HOME/install $HOME/docs
    - name: build
      run: ./ci/build.sh Release None OFF None "core,python,doc" -DCMAKE_INSTALL_PREFIX=$HOME/install -DOPENVDB_PYTHON_WRAP_ALL_GRID_TYPES=ON -DDISABLE_DEPENDENCY_VERSION_CHECKS=ON
    - name: install
      run: cp -r $HOME/install/doc/html/* $HOME/docs
    - name: epydoc
      run: |
        export LD_LIBRARY_PATH=$HOME/install/lib64
        export PYTHONPATH=$HOME/install/lib64/python2.7
        epydoc --html -o $HOME/docs/python pyopenvdb
